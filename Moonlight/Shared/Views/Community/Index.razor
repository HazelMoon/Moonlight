@page "/community"

@using Moonlight.App.Repositories
@using Moonlight.App.Database.Entities.Community
@using Microsoft.EntityFrameworkCore
@using Moonlight.Shared.Components.Community

@inject Repository<Post> PostRepository

<div class="row">
    <LazyLoader @ref="LazyLoader" Load="Load">
        @foreach (var post in Posts)
        {
            <PostView Post="post" OnUpdate="() => LazyLoader.Reload()" />
            <div class="mb-10"></div>
        }
    </LazyLoader>
</div>

@code
{
    private LazyLoader LazyLoader;
    private Post[] Posts;
    
    private Task Load(LazyLoader _)
    {
        Posts = PostRepository
            .Get()
            .Include(x => x.Author)
            .ToArray();
        
        return Task.CompletedTask;
    }
}
